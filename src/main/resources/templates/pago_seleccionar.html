<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Seleccionar Método de Pago</title>
    <link rel="stylesheet" th:href="@{/carrito.css}">
    <link rel="stylesheet" th:href="@{/footer.css}">
    <style>
        body {
            background: #f7b733;
            font-family: 'Poppins', sans-serif;
            margin: 0;
        }

        .contenedor {
            max-width: 600px;
            margin: 50px auto;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        h1, h2 {
            text-align: center;
            color: #512da8;
        }

        .metodo {
            margin: 15px 0;
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 10px;
            cursor: pointer;
        }

        .metodo:hover {
            background: #f0f0f0;
        }

        .btn-confirmar {
            display: block;
            margin: 25px auto 0;
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 25px;
            border-radius: 12px;
            width: 350px;
            text-align: center;
        }

        .close {
            float: right;
            font-size: 22px;
            cursor: pointer;
            color: #888;
        }

        input[type="text"], select {
            width: 90%;
            padding: 8px;
            margin: 8px 0;
            border-radius: 8px;
            border: 1px solid #ccc;
        }

        button {
            background-color: #512da8;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
        }

        button:hover {
            background-color: #3e2284;
        }

        .error { color: #b00020; font-size: 0.9rem; margin-top: 6px; }
    </style>
</head>
<body>
<header>
    <h1>Seleccionar Método de Pago</h1>
    <a href="/menu/confirmar" class="btn-volver">⬅ Volver</a>
</header>

<div class="contenedor">
    <h2>Elige tu método de pago</h2>

    <form th:action="@{/pago/procesar}" method="post" id="formPago">
        <input type="hidden" name="total" th:value="${total}">
        <input type="hidden" name="metodoPago" id="metodoPago">
        <input type="hidden" name="cuotas" id="cuotas">
        <input type="hidden" name="numeroTarjeta" id="numeroTarjeta">
        <input type="hidden" name="titularTarjeta" id="titularTarjeta">

        <div class="metodo" onclick="abrirModal('credito')">
            <label>Tarjeta de Crédito</label>
        </div>

        <div class="metodo" onclick="abrirModal('debito')">
            <label>Tarjeta de Débito</label>
        </div>

        <div class="metodo" onclick="seleccionarEfectivo()">
            <input type="radio" name="pagoRadio" id="efectivo">
            <label for="efectivo">Pago contra entrega (efectivo)</label>
        </div>

        <div th:if="${error}" class="error">
            <p th:text="${error}"></p>
        </div>

        <button type="submit" class="btn-confirmar">Confirmar pago</button>
    </form>
</div>

<!-- MODAL CRÉDITO -->
<div class="modal" id="modalCredito">
    <div class="modal-content">
        <span class="close" onclick="cerrarModal('modalCredito')">&times;</span>
        <h3>Datos de Tarjeta de Crédito</h3>
        <input type="text" id="numCredito" placeholder="Número de tarjeta" maxlength="16">
        <input type="text" id="titularCredito" placeholder="Titular de la tarjeta">
        <label>Seleccione el número de cuotas:</label>
        <select id="selectCuotas">
            <option value="1">1 cuota</option>
            <option value="3">3 cuotas</option>
            <option value="6">6 cuotas</option>
            <option value="12">12 cuotas</option>
        </select>
        <br><br>
        <button onclick="aceptarCredito()">Aceptar</button>
    </div>
</div>

<!-- MODAL DÉBITO -->
<div class="modal" id="modalDebito">
    <div class="modal-content">
        <span class="close" onclick="cerrarModal('modalDebito')">&times;</span>
        <h3>Datos de Tarjeta de Débito</h3>
        <input type="text" id="numDebito" placeholder="Número de tarjeta" maxlength="16">
        <input type="text" id="titularDebito" placeholder="Titular de la tarjeta">
        <br><br>
        <button onclick="aceptarDebito()">Aceptar</button>
    </div>
</div>

<script>
    const metodoInput = document.getElementById("metodoPago");
    const cuotasInput = document.getElementById("cuotas");
    const numTarjetaInput = document.getElementById("numeroTarjeta");
    const titularInput = document.getElementById("titularTarjeta");

    function abrirModal(tipo) {
        if (tipo === "credito") document.getElementById("modalCredito").style.display = "block";
        else if (tipo === "debito") document.getElementById("modalDebito").style.display = "block";
    }

    function cerrarModal(id) {
        document.getElementById(id).style.display = "none";
    }

    function aceptarCredito() {
        const num = document.getElementById("numCredito").value.trim();
        const tit = document.getElementById("titularCredito").value.trim();
        const cuotas = document.getElementById("selectCuotas").value;

        if (!num || !tit) {
            alert("Por favor complete todos los campos.");
            return;
        }

        metodoInput.value = "credito";
        cuotasInput.value = cuotas;
        numTarjetaInput.value = num;
        titularInput.value = tit;

        cerrarModal("modalCredito");
        alert("Pago con tarjeta de crédito listo para procesar.");
    }

    function aceptarDebito() {
        const num = document.getElementById("numDebito").value.trim();
        const tit = document.getElementById("titularDebito").value.trim();

        if (!num || !tit) {
            alert("Por favor complete todos los campos.");
            return;
        }

        metodoInput.value = "debito";
        cuotasInput.value = "1";
        numTarjetaInput.value = num;
        titularInput.value = tit;

        cerrarModal("modalDebito");
        alert("Pago con tarjeta de débito listo para procesar.");
    }

    function seleccionarEfectivo() {
        metodoInput.value = "efectivo";
    }

    window.onclick = function(event) {
        const modals = [document.getElementById("modalCredito"), document.getElementById("modalDebito")];
        modals.forEach(m => { if (event.target === m) m.style.display = "none"; });
    };
</script>

<div th:replace="fragments/footer :: footer"></div>
</body>
</html>